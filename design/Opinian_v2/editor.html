<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Editor - Opinian</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Core Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://unpkg.com/splitting@1.0.6/dist/splitting.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/splitting@1.0.6/dist/splitting.css">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Noir Color Palette */
            --noir-black: #0a0a0a;
            --noir-charcoal: #1a1a1a;
            --noir-dark-gray: #2d2d2d;
            --noir-gray: #4a4a4a;
            --noir-light-gray: #8a8a8a;
            --noir-cream: #f8f6f0;
            --noir-ivory: #faf8f3;
            --noir-gold: #d4af37;
            --noir-burgundy: #722f37;
            --noir-deep-burgundy: #5a2429;
            --noir-shadow: rgba(0, 0, 0, 0.8);
            --noir-gold-glow: rgba(212, 175, 55, 0.3);
            
            /* Typography */
            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Inter', sans-serif;
            
            /* Spacing */
            --container-max: 1400px;
            --section-padding: 120px 0;
            --element-spacing: 2rem;
            
            /* Transitions */
            --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-quick: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: linear-gradient(135deg, var(--noir-black) 0%, var(--noir-charcoal) 100%);
            color: var(--noir-cream);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--noir-gold);
            z-index: 1000;
            padding: 1rem 0;
            transition: var(--transition-smooth);
        }

        .nav-container {
            max-width: var(--container-max);
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: var(--font-serif);
            font-size: 2rem;
            font-weight: 700;
            color: var(--noir-gold);
            text-decoration: none;
            letter-spacing: 0.1em;
            text-shadow: 0 0 20px var(--noir-gold-glow);
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--noir-cream);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition-quick);
            position: relative;
        }

        .nav-links a:hover {
            color: var(--noir-gold);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--noir-gold);
            transition: var(--transition-quick);
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        /* Editor Container */
        .editor-page {
            padding-top: 100px;
            min-height: 100vh;
        }

        .editor-header {
            max-width: var(--container-max);
            margin: 0 auto 2rem;
            padding: 0 2rem;
            text-align: center;
        }

        .editor-title {
            font-family: var(--font-serif);
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 700;
            color: var(--noir-gold);
            margin-bottom: 1rem;
        }

        .editor-subtitle {
            color: var(--noir-light-gray);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Blog Editor Styles */
        .blog-editor {
            max-width: var(--container-max);
            margin: 0 auto;
            padding: 0 2rem;
            background: linear-gradient(145deg, var(--noir-charcoal), var(--noir-dark-gray));
            border: 1px solid var(--noir-gold);
            border-radius: 0;
            overflow: hidden;
        }

        .editor-toolbar {
            background: var(--noir-black);
            border-bottom: 1px solid var(--noir-gold);
            padding: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
            position: sticky;
            top: 80px;
            z-index: 100;
        }

        .toolbar-group {
            display: flex;
            gap: 0.25rem;
            align-items: center;
            border-right: 1px solid var(--noir-gray);
            padding-right: 0.5rem;
            margin-right: 0.5rem;
        }

        .toolbar-group:last-child {
            border-right: none;
            margin-right: 0;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            border: 1px solid var(--noir-gray);
            background: var(--noir-dark-gray);
            color: var(--noir-cream);
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-quick);
            font-size: 0.9rem;
        }

        .btn-icon:hover {
            background: var(--noir-gold);
            color: var(--noir-black);
            border-color: var(--noir-gold);
        }

        .btn-icon.active {
            background: var(--noir-gold);
            color: var(--noir-black);
            border-color: var(--noir-gold);
        }

        .font-family-select,
        .font-size-select {
            background: var(--noir-dark-gray);
            border: 1px solid var(--noir-gray);
            color: var(--noir-cream);
            padding: 0.5rem;
            border-radius: 0;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .color-picker {
            width: 36px;
            height: 36px;
            border: 1px solid var(--noir-gray);
            background: var(--noir-dark-gray);
            border-radius: 0;
            cursor: pointer;
            padding: 2px;
        }

        .editor-content {
            padding: 2rem;
        }

        .editor-title {
            margin-bottom: 2rem;
        }

        .title-input {
            width: 100%;
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--noir-gold);
            color: var(--noir-cream);
            font-family: var(--font-serif);
            font-size: 2.5rem;
            font-weight: 600;
            padding: 1rem 0;
            outline: none;
            transition: var(--transition-quick);
        }

        .title-input::placeholder {
            color: var(--noir-gray);
        }

        .title-input:focus {
            border-bottom-color: var(--noir-gold);
            box-shadow: 0 2px 20px var(--noir-gold-glow);
        }

        .editor-body {
            min-height: 500px;
        }

        .editor-textarea {
            width: 100%;
            min-height: 500px;
            background: transparent;
            border: none;
            color: var(--noir-cream);
            font-family: var(--font-sans);
            font-size: 1.1rem;
            line-height: 1.8;
            padding: 1rem;
            outline: none;
            resize: none;
        }

        .editor-textarea:empty::before {
            content: attr(placeholder);
            color: var(--noir-gray);
            pointer-events: none;
        }

        .editor-footer {
            background: var(--noir-black);
            border-top: 1px solid var(--noir-gold);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .editor-status {
            display: flex;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: var(--noir-light-gray);
        }

        .editor-status span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .editor-status span.unsaved {
            color: var(--noir-gold);
        }

        .editor-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0;
            font-family: var(--font-sans);
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: var(--transition-smooth);
            cursor: pointer;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--noir-gold);
            color: var(--noir-black);
            border: 2px solid var(--noir-gold);
        }

        .btn-primary:hover {
            background: transparent;
            color: var(--noir-gold);
            box-shadow: 0 0 30px var(--noir-gold-glow);
        }

        .btn-secondary {
            background: transparent;
            color: var(--noir-cream);
            border: 2px solid var(--noir-cream);
        }

        .btn-secondary:hover {
            background: var(--noir-cream);
            color: var(--noir-black);
        }

        .btn-outline {
            background: transparent;
            color: var(--noir-gold);
            border: 2px solid var(--noir-gold);
        }

        .btn-outline:hover {
            background: var(--noir-gold);
            color: var(--noir-black);
        }

        /* Fullscreen mode */
        .blog-editor.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 999;
            max-width: none;
            margin: 0;
            border: none;
            border-radius: 0;
            display: flex;
            flex-direction: column;
        }

        .blog-editor.fullscreen .editor-body {
            flex: 1;
            min-height: auto;
        }

        .blog-editor.fullscreen .editor-textarea {
            min-height: auto;
            height: 100%;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 100px;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 0;
            color: var(--noir-cream);
            font-weight: 500;
            z-index: 1001;
            transform: translateX(100%);
            transition: var(--transition-smooth);
            border-left: 4px solid;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-success {
            background: var(--noir-charcoal);
            border-left-color: #4ade80;
        }

        .notification-error {
            background: var(--noir-charcoal);
            border-left-color: #ef4444;
        }

        .notification-warning {
            background: var(--noir-charcoal);
            border-left-color: #f59e0b;
        }

        .notification-info {
            background: var(--noir-charcoal);
            border-left-color: var(--noir-gold);
        }

        /* Media Upload */
        .media-upload {
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(145deg, var(--noir-dark-gray), var(--noir-charcoal));
            border: 1px solid var(--noir-gold);
            border-radius: 0;
        }

        .media-upload h3 {
            font-family: var(--font-serif);
            color: var(--noir-gold);
            margin-bottom: 1rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .editor-toolbar {
                position: relative;
                top: 0;
                flex-wrap: wrap;
                justify-content: center;
            }

            .toolbar-group {
                border-right: none;
                margin-right: 0;
                padding-right: 0;
            }

            .title-input {
                font-size: 2rem;
            }

            .editor-footer {
                flex-direction: column;
                align-items: stretch;
            }

            .editor-actions {
                justify-content: center;
            }
        }

        /* Animation Classes */
        .fade-in-up {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .fade-in-up.animate {
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--noir-charcoal);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--noir-gold);
            border-radius: 0;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--noir-burgundy);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">Opinian</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="blog.html">Blogs</a></li>
                <li><a href="ai-tools.html">AI Assistant</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="login.html" class="btn btn-secondary">Logout</a></li>
            </ul>
        </div>
    </nav>

    <!-- Editor Page -->
    <div class="editor-page">
        <!-- Editor Header -->
        <div class="editor-header">
            <h1 class="editor-title">Blog Editor</h1>
            <p class="editor-subtitle">
                Craft your story with the elegance of noir and the power of modern tools
            </p>
        </div>

        <!-- Blog Editor Container -->
        <div class="blog-editor" id="blogEditor">
            <!-- Toolbar will be populated by JavaScript -->
        </div>
    </div>

    <!-- Media Upload Section -->
    <div class="media-upload">
        <h3><i class="fas fa-images"></i> Media Library</h3>
        <div id="mediaUploader">
            <!-- Media uploader will be populated by JavaScript -->
        </div>
    </div>

    <script>
        // Initialize the blog editor when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize blog editor
            window.blogEditor = new BlogEditor('blogEditor', {
                placeholder: 'Begin your story here... Let the words flow like shadows in the night.',
                autoSave: true,
                autoSaveInterval: 30000
            });

            // Initialize media uploader
            window.mediaUploader = new MediaUploader('mediaUploader', {
                maxFileSize: 5 * 1024 * 1024, // 5MB
                allowedTypes: ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml'],
                maxFiles: 10,
                uploadUrl: '/api/media/upload'
            });

            // Add page-specific animations
            anime({
                targets: '.editor-header',
                opacity: [0, 1],
                translateY: [30, 0],
                duration: 800,
                delay: 200,
                easing: 'easeOutCubic'
            });

            anime({
                targets: '.blog-editor',
                opacity: [0, 1],
                translateY: [50, 0],
                duration: 1000,
                delay: 400,
                easing: 'easeOutCubic'
            });

            anime({
                targets: '.media-upload',
                opacity: [0, 1],
                translateY: [30, 0],
                duration: 800,
                delay: 600,
                easing: 'easeOutCubic'
            });
        });

        // Blog Editor Class (simplified version for this page)
        class BlogEditor {
            constructor(containerId, options = {}) {
                this.container = document.getElementById(containerId);
                this.options = {
                    placeholder: 'Start writing your story...',
                    autoSave: true,
                    autoSaveInterval: 30000,
                    ...options
                };
                
                this.editor = null;
                this.currentPost = null;
                this.autoSaveTimer = null;
                this.isDirty = false;
                
                this.init();
            }

            init() {
                this.createEditorUI();
                this.setupEditor();
                this.setupToolbar();
                this.setupEventListeners();
                this.setupAutoSave();
            }

            createEditorUI() {
                this.container.innerHTML = `
                    <div class="editor-toolbar">
                        <div class="toolbar-group">
                            <button type="button" class="btn-icon" data-command="bold" title="Bold (Ctrl+B)">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" class="btn-icon" data-command="italic" title="Italic (Ctrl+I)">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" class="btn-icon" data-command="underline" title="Underline (Ctrl+U)">
                                <i class="fas fa-underline"></i>
                            </button>
                            <button type="button" class="btn-icon" data-command="strikeThrough" title="Strikethrough">
                                <i class="fas fa-strikethrough"></i>
                            </button>
                        </div>
                        
                        <div class="toolbar-group">
                            <select class="font-family-select" data-command="fontName">
                                <option value="">Font Family</option>
                                <option value="Arial">Arial</option>
                                <option value="Times New Roman">Times New Roman</option>
                                <option value="Courier New">Courier New</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Verdana">Verdana</option>
                            </select>
                            
                            <select class="font-size-select" data-command="fontSize">
                                <option value="1">12px</option>
                                <option value="2">14px</option>
                                <option value="3" selected>16px</option>
                                <option value="4">18px</option>
                                <option value="5">24px</option>
                                <option value="6">32px</option>
                                <option value="7">48px</option>
                            </select>
                        </div>
                        
                        <div class="toolbar-group">
                            <button type="button" class="btn-icon" data-command="justifyLeft" title="Align Left">
                                <i class="fas fa-align-left"></i>
                            </button>
                            <button type="button" class="btn-icon" data-command="justifyCenter" title="Align Center">
                                <i class="fas fa-align-center"></i>
                            </button>
                            <button type="button" class="btn-icon" data-command="justifyRight" title="Align Right">
                                <i class="fas fa-align-right"></i>
                            </button>
                            <button type="button" class="btn-icon" data-command="justifyFull" title="Justify">
                                <i class="fas fa-align-justify"></i>
                            </button>
                        </div>
                        
                        <div class="toolbar-group">
                            <button type="button" class="btn-icon" data-command="insertUnorderedList" title="Bullet List">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button type="button" class="btn-icon" data-command="insertOrderedList" title="Numbered List">
                                <i class="fas fa-list-ol"></i>
                            </button>
                        </div>
                        
                        <div class="toolbar-group">
                            <button type="button" class="btn-icon" id="insertImage" title="Insert Image">
                                <i class="fas fa-image"></i>
                            </button>
                            <button type="button" class="btn-icon" id="insertLink" title="Insert Link">
                                <i class="fas fa-link"></i>
                            </button>
                            <input type="color" class="color-picker" id="textColor" title="Text Color" value="#f8f6f0">
                            <input type="color" class="color-picker" id="bgColor" title="Background Color" value="#d4af37">
                        </div>
                        
                        <div class="toolbar-group">
                            <button type="button" class="btn-icon" id="undo" title="Undo (Ctrl+Z)">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button type="button" class="btn-icon" id="redo" title="Redo (Ctrl+Y)">
                                <i class="fas fa-redo"></i>
                            </button>
                            <button type="button" class="btn-icon" id="fullscreen" title="Fullscreen">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="editor-content">
                        <div class="editor-title">
                            <input type="text" id="postTitle" placeholder="Enter your blog title..." class="title-input">
                        </div>
                        
                        <div class="editor-body">
                            <div id="editor" class="editor-textarea" contenteditable="true" 
                                 placeholder="${this.options.placeholder}"></div>
                        </div>
                    </div>
                    
                    <div class="editor-footer">
                        <div class="editor-status">
                            <span id="wordCount"><i class="fas fa-file-word"></i> 0 words</span>
                            <span id="readingTime"><i class="fas fa-clock"></i> 0 min read</span>
                            <span id="saveStatus"><i class="fas fa-save"></i> Saved</span>
                        </div>
                        
                        <div class="editor-actions">
                            <button type="button" id="saveDraft" class="btn btn-secondary">Save Draft</button>
                            <button type="button" id="preview" class="btn btn-outline">Preview</button>
                            <button type="button" id="publish" class="btn btn-primary">Publish</button>
                        </div>
                    </div>
                `;
            }

            setupEditor() {
                this.editor = this.container.querySelector('#editor');
                this.titleInput = this.container.querySelector('#postTitle');
                
                document.designMode = 'on';
                
                this.editor.addEventListener('input', () => {
                    this.updateWordCount();
                    this.markAsDirty();
                });

                this.titleInput.addEventListener('input', () => {
                    this.markAsDirty();
                });

                this.editor.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch (e.key) {
                            case 's':
                                e.preventDefault();
                                this.saveDraft();
                                break;
                            case 'z':
                                e.preventDefault();
                                document.execCommand('undo');
                                break;
                            case 'y':
                                e.preventDefault();
                                document.execCommand('redo');
                                break;
                        }
                    }
                });
            }

            setupToolbar() {
                const toolbarButtons = this.container.querySelectorAll('[data-command]');
                
                toolbarButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.preventDefault();
                        const command = button.dataset.command;
                        const value = button.dataset.value || null;
                        
                        if (command === 'fontName' || command === 'fontSize') {
                            const select = button;
                            document.execCommand(command, false, select.value);
                        } else {
                            document.execCommand(command, false, value);
                        }
                        
                        this.updateToolbarState();
                        this.markAsDirty();
                    });
                });

                const textColorPicker = this.container.querySelector('#textColor');
                const bgColorPicker = this.container.querySelector('#bgColor');
                
                textColorPicker.addEventListener('change', (e) => {
                    document.execCommand('foreColor', false, e.target.value);
                    this.markAsDirty();
                });

                bgColorPicker.addEventListener('change', (e) => {
                    document.execCommand('hiliteColor', false, e.target.value);
                    this.markAsDirty();
                });

                this.container.querySelector('#insertImage').addEventListener('click', () => {
                    this.insertImage();
                });

                this.container.querySelector('#insertLink').addEventListener('click', () => {
                    this.insertLink();
                });

                this.container.querySelector('#undo').addEventListener('click', () => {
                    document.execCommand('undo');
                });

                this.container.querySelector('#redo').addEventListener('click', () => {
                    document.execCommand('redo');
                });

                this.container.querySelector('#fullscreen').addEventListener('click', () => {
                    this.toggleFullscreen();
                });
            }

            setupEventListeners() {
                this.container.querySelector('#saveDraft').addEventListener('click', () => {
                    this.saveDraft();
                });

                this.container.querySelector('#preview').addEventListener('click', () => {
                    this.previewPost();
                });

                this.container.querySelector('#publish').addEventListener('click', () => {
                    this.publishPost();
                });
            }

            insertImage() {
                const imageUrl = prompt('Enter image URL:');
                if (imageUrl) {
                    const altText = prompt('Enter alt text (optional):') || '';
                    document.execCommand('insertImage', false, imageUrl);
                    
                    const images = this.editor.querySelectorAll('img');
                    const newImage = images[images.length - 1];
                    if (newImage) {
                        newImage.alt = altText;
                        newImage.style.maxWidth = '100%';
                        newImage.style.height = 'auto';
                    }
                    
                    this.markAsDirty();
                }
            }

            insertLink() {
                const selection = window.getSelection();
                const linkUrl = prompt('Enter URL:');
                
                if (linkUrl) {
                    const linkText = selection.toString() || prompt('Enter link text:');
                    if (linkText) {
                        document.execCommand('createLink', false, linkUrl);
                        this.markAsDirty();
                    }
                }
            }

            toggleFullscreen() {
                const editor = this.container.querySelector('.blog-editor');
                editor.classList.toggle('fullscreen');
                
                const button = this.container.querySelector('#fullscreen i');
                if (editor.classList.contains('fullscreen')) {
                    button.className = 'fas fa-compress';
                } else {
                    button.className = 'fas fa-expand';
                }
            }

            updateWordCount() {
                const content = this.editor.textContent || '';
                const title = this.titleInput.value || '';
                const totalText = title + ' ' + content;
                
                const wordCount = totalText.trim().split(/\s+/).filter(word => word.length > 0).length;
                const readingTime = Math.ceil(wordCount / 200);
                
                this.container.querySelector('#wordCount').innerHTML = `<i class="fas fa-file-word"></i> ${wordCount} words`;
                this.container.querySelector('#readingTime').innerHTML = `<i class="fas fa-clock"></i> ${readingTime} min read`;
            }

            updateToolbarState() {
                const commands = ['bold', 'italic', 'underline', 'strikeThrough'];
                
                commands.forEach(command => {
                    const button = this.container.querySelector(`[data-command="${command}"]`);
                    if (button) {
                        button.classList.toggle('active', document.queryCommandState(command));
                    }
                });
            }

            markAsDirty() {
                this.isDirty = true;
                this.container.querySelector('#saveStatus').innerHTML = `<i class="fas fa-save"></i> Unsaved changes`;
                this.container.querySelector('#saveStatus').classList.add('unsaved');
            }

            markAsClean() {
                this.isDirty = false;
                this.container.querySelector('#saveStatus').innerHTML = `<i class="fas fa-save"></i> Saved`;
                this.container.querySelector('#saveStatus').classList.remove('unsaved');
            }

            setupAutoSave() {
                if (this.options.autoSave) {
                    this.autoSaveTimer = setInterval(() => {
                        if (this.isDirty) {
                            this.saveDraft(true);
                        }
                    }, this.options.autoSaveInterval);
                }
            }

            async saveDraft(isAutoSave = false) {
                try {
                    const postData = {
                        title: this.titleInput.value,
                        content: this.editor.innerHTML,
                        content_text: this.editor.textContent,
                        status: 'draft',
                        word_count: this.editor.textContent.trim().split(/\s+/).length,
                        reading_time: Math.ceil(this.editor.textContent.trim().split(/\s+/).length / 200)
                    };

                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    this.markAsClean();
                    if (!isAutoSave) {
                        this.showNotification('Draft saved successfully', 'success');
                    }
                } catch (error) {
                    console.error('Save error:', error);
                    this.showNotification('Failed to save draft', 'error');
                }
            }

            previewPost() {
                const previewWindow = window.open('', '_blank');
                const previewContent = `
                    <!DOCTYPE html>
                    <html>
                        <head>
                            <title>${this.titleInput.value}</title>
                            <meta charset="utf-8">
                            <style>
                                body { 
                                    font-family: 'Inter', sans-serif; 
                                    margin: 40px; 
                                    background: #0a0a0a;
                                    color: #f8f6f0;
                                    line-height: 1.8;
                                }
                                h1 { 
                                    font-family: 'Playfair Display', serif;
                                    color: #d4af37; 
                                    font-size: 3rem;
                                    margin-bottom: 2rem;
                                    text-align: center;
                                }
                                .content { 
                                    max-width: 800px;
                                    margin: 0 auto;
                                    line-height: 1.8;
                                }
                                .content p { margin-bottom: 1.5rem; }
                                .content img { max-width: 100%; height: auto; margin: 2rem 0; }
                                .preview-header {
                                    text-align: center;
                                    margin-bottom: 3rem;
                                    padding-bottom: 2rem;
                                    border-bottom: 2px solid #d4af37;
                                }
                            </style>
                        </head>
                        <body>
                            <div class="preview-header">
                                <h1>${this.titleInput.value}</h1>
                                <p style="color: #8a8a8a;">Preview Mode</p>
                            </div>
                            <div class="content">${this.editor.innerHTML}</div>
                        </body>
                    </html>
                `;
                
                previewWindow.document.write(previewContent);
                previewWindow.document.close();
            }

            async publishPost() {
                if (!this.titleInput.value.trim()) {
                    this.showNotification('Please enter a title before publishing', 'warning');
                    return;
                }

                if (!this.editor.textContent.trim()) {
                    this.showNotification('Please add content before publishing', 'warning');
                    return;
                }

                try {
                    const postData = {
                        title: this.titleInput.value,
                        content: this.editor.innerHTML,
                        content_text: this.editor.textContent,
                        status: 'published',
                        published_at: new Date().toISOString(),
                        word_count: this.editor.textContent.trim().split(/\s+/).length,
                        reading_time: Math.ceil(this.editor.textContent.trim().split(/\s+/).length / 200)
                    };

                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    this.showNotification('Post published successfully!', 'success');
                    
                    setTimeout(() => {
                        window.location.href = '/blog.html';
                    }, 2000);
                } catch (error) {
                    console.error('Publish error:', error);
                    this.showNotification('Failed to publish post', 'error');
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            destroy() {
                if (this.autoSaveTimer) {
                    clearInterval(this.autoSaveTimer);
                }
                
                document.designMode = 'off';
            }
        }

        // Media Uploader Class (simplified version for this page)
        class MediaUploader {
            constructor(containerId, options = {}) {
                this.container = document.getElementById(containerId);
                this.options = {
                    maxFileSize: 5 * 1024 * 1024,
                    allowedTypes: ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml'],
                    maxFiles: 10,
                    uploadUrl: '/api/media/upload',
                    ...options
                };
                
                this.uploadedFiles = [];
                this.uploadQueue = [];
                this.isUploading = false;
                
                this.init();
            }

            init() {
                this.createUI();
                this.setupEventListeners();
                this.setupDragAndDrop();
            }

            createUI() {
                this.container.innerHTML = `
                    <div class="media-uploader">
                        <div class="upload-zone" id="uploadZone">
                            <div class="upload-prompt">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--noir-gold); margin-bottom: 1rem;"></i>
                                <h3 style="color: var(--noir-gold); margin-bottom: 0.5rem;">Drop files here or click to browse</h3>
                                <p style="color: var(--noir-light-gray); margin-bottom: 1.5rem;">Supports JPG, PNG, GIF, WebP, SVG (Max 5MB each)</p>
                                <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
                                <button type="button" id="browseBtn" class="btn btn-primary">
                                    Choose Files
                                </button>
                            </div>
                        </div>
                        
                        <div class="upload-progress" id="uploadProgress" style="display: none;">
                            <div class="progress-header">
                                <span>Uploading files...</span>
                                <span id="progressText">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                        </div>
                        
                        <div class="uploaded-files" id="uploadedFiles">
                            <h3 style="color: var(--noir-gold); margin-bottom: 1rem;">Uploaded Files</h3>
                            <div class="file-grid" id="fileGrid">
                                <div class="empty-state" style="text-align: center; color: var(--noir-light-gray); padding: 2rem;">
                                    <i class="fas fa-images" style="font-size: 2rem; margin-bottom: 1rem; color: var(--noir-gray);"></i>
                                    <p>No files uploaded yet</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            setupEventListeners() {
                const browseBtn = this.container.querySelector('#browseBtn');
                const fileInput = this.container.querySelector('#fileInput');

                browseBtn.addEventListener('click', () => {
                    fileInput.click();
                });

                fileInput.addEventListener('change', (e) => {
                    this.handleFileSelection(e.target.files);
                });
            }

            setupDragAndDrop() {
                const uploadZone = this.container.querySelector('#uploadZone');

                uploadZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadZone.style.borderColor = 'var(--noir-gold)';
                    uploadZone.style.backgroundColor = 'rgba(212, 175, 55, 0.1)';
                });

                uploadZone.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadZone.style.borderColor = 'var(--noir-gold)';
                    uploadZone.style.backgroundColor = 'transparent';
                });

                uploadZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadZone.style.borderColor = 'var(--noir-gold)';
                    uploadZone.style.backgroundColor = 'transparent';
                    this.handleFileSelection(e.dataTransfer.files);
                });
            }

            handleFileSelection(files) {
                const fileArray = Array.from(files);
                const validFiles = this.validateFiles(fileArray);

                if (validFiles.length === 0) {
                    return;
                }

                if (this.uploadedFiles.length + validFiles.length > this.options.maxFiles) {
                    this.showNotification(`Maximum ${this.options.maxFiles} files allowed`, 'warning');
                    return;
                }

                this.uploadQueue.push(...validFiles);
                this.processUploadQueue();
            }

            validateFiles(files) {
                const validFiles = [];
                
                files.forEach(file => {
                    if (!this.options.allowedTypes.includes(file.type)) {
                        this.showNotification(`Invalid file type: ${file.name}`, 'error');
                        return;
                    }

                    if (file.size > this.options.maxFileSize) {
                        this.showNotification(`File too large: ${file.name}`, 'error');
                        return;
                    }

                    validFiles.push(file);
                });

                return validFiles;
            }

            async processUploadQueue() {
                if (this.isUploading || this.uploadQueue.length === 0) {
                    return;
                }

                this.isUploading = true;
                this.showUploadProgress(true);

                const totalFiles = this.uploadQueue.length;
                let processedFiles = 0;

                for (const file of this.uploadQueue) {
                    try {
                        await this.simulateUpload(file, (progress) => {
                            const overallProgress = (processedFiles + progress / 100) / totalFiles * 100;
                            this.updateProgress(overallProgress);
                        });
                        
                        processedFiles++;
                    } catch (error) {
                        console.error('Upload error:', error);
                        this.showNotification(`Failed to upload ${file.name}`, 'error');
                    }
                }

                this.uploadQueue = [];
                this.isUploading = false;
                this.showUploadProgress(false);
                this.updateFileGrid();
            }

            async simulateUpload(file, onProgress) {
                return new Promise((resolve) => {
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 10;
                        onProgress(progress);
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            
                            const mockFileData = {
                                id: Date.now().toString(),
                                originalName: file.name,
                                fileSize: file.size,
                                mimeType: file.type,
                                url: URL.createObjectURL(file),
                                thumbnailUrl: URL.createObjectURL(file),
                                uploadedAt: new Date().toISOString()
                            };
                            
                            this.uploadedFiles.push(mockFileData);
                            resolve(mockFileData);
                        }
                    }, 100);
                });
            }

            showUploadProgress(show) {
                const progress = this.container.querySelector('#uploadProgress');
                progress.style.display = show ? 'block' : 'none';
            }

            updateProgress(percentage) {
                const progressFill = this.container.querySelector('#progressFill');
                const progressText = this.container.querySelector('#progressText');
                
                progressFill.style.width = `${percentage}%`;
                progressText.textContent = `${Math.round(percentage)}%`;
            }

            updateFileGrid() {
                const fileGrid = this.container.querySelector('#fileGrid');
                
                if (this.uploadedFiles.length === 0) {
                    fileGrid.innerHTML = `
                        <div class="empty-state" style="text-align: center; color: var(--noir-light-gray); padding: 2rem;">
                            <i class="fas fa-images" style="font-size: 2rem; margin-bottom: 1rem; color: var(--noir-gray);"></i>
                            <p>No files uploaded yet</p>
                        </div>
                    `;
                    return;
                }

                fileGrid.innerHTML = this.uploadedFiles.map(file => `
                    <div class="file-item" data-id="${file.id}" style="background: var(--noir-dark-gray); border: 1px solid var(--noir-gray); padding: 1rem; border-radius: 0; position: relative;">
                        <div class="file-preview" style="width: 100%; height: 120px; background: var(--noir-charcoal); margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            <img src="${file.thumbnailUrl}" alt="${file.originalName}" style="max-width: 100%; max-height: 100%; object-fit: cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div style="display: none; color: var(--noir-gold); font-size: 2rem;">
                                <i class="fas fa-file-image"></i>
                            </div>
                        </div>
                        <div class="file-info">
                            <div class="file-name" style="color: var(--noir-cream); font-weight: 500; margin-bottom: 0.5rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${file.originalName}">${file.originalName}</div>
                            <div class="file-meta" style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--noir-light-gray);">
                                <span class="file-size">${this.formatFileSize(file.fileSize)}</span>
                                <span class="file-type">${file.mimeType.split('/')[1].toUpperCase()}</span>
                            </div>
                        </div>
                        <div class="file-actions" style="position: absolute; top: 0.5rem; right: 0.5rem; display: flex; gap: 0.5rem;">
                            <button type="button" class="btn-icon" onclick="navigator.clipboard.writeText('${file.url}').then(() => window.blogEditor.showNotification('URL copied to clipboard', 'success'))" title="Copy URL" style="width: 28px; height: 28px; font-size: 0.8rem;">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button type="button" class="btn-icon" onclick="this.closest('.file-item').remove(); window.mediaUploader.uploadedFiles = window.mediaUploader.uploadedFiles.filter(f => f.id !== '${file.id}');" title="Delete" style="width: 28px; height: 28px; font-size: 0.8rem;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');

                // Add grid layout
                fileGrid.style.display = 'grid';
                fileGrid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(200px, 1fr))';
                fileGrid.style.gap = '1rem';
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            getUploadedFiles() {
                return this.uploadedFiles;
            }

            clearFiles() {
                this.uploadedFiles = [];
                this.updateFileGrid();
            }
        }
    </script>
</body>
</html>