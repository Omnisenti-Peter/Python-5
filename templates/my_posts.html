{% extends "base.html" %}

{% block title %}My Posts - Opinian{% endblock %}

{% block content %}
<div class="main-content" style="padding-top: 2rem;">
    <h1 style="font-family: var(--font-display); color: var(--art-gold); text-align: center; margin-bottom: 2rem; font-size: 2.5rem;">
        <i class="fas fa-folder-open"></i> My Stories
    </h1>

    <!-- Tabs for Published and Drafts -->
    <div style="text-align: center; margin-bottom: 2rem;">
        <button onclick="showTab('published')" id="tab-published" class="blog-btn" style="margin: 0 0.5rem;">
            <i class="fas fa-check-circle"></i> Published ({{ published_posts|length }})
        </button>
        <button onclick="showTab('drafts')" id="tab-drafts" class="blog-btn secondary" style="margin: 0 0.5rem;">
            <i class="fas fa-edit"></i> Drafts ({{ draft_posts|length }})
        </button>
    </div>

    <!-- Published Posts -->
    <div id="published-section" class="blog-posts-container">
        {% if published_posts %}
            {% for post in published_posts %}
            <div class="blog-post">
                <h3 class="blog-post-title">{{ post.title }}</h3>
                <div class="blog-post-meta">
                    Published on {{ post.created_at|format_date }}
                    {% if post.ai_enhanced %}
                    <span style="color: var(--art-gold);"><i class="fas fa-robot"></i> AI Enhanced</span>
                    {% endif %}
                </div>
                <div class="blog-post-content">
                    {{ post.content|truncate_words(50) }}
                </div>
                <div class="blog-post-actions">
                    <a href="{{ url_for('view_post', post_id=post.id) }}" class="blog-post-btn">
                        <i class="fas fa-eye"></i> View
                    </a>
                    <a href="{{ url_for('edit_blog', post_id=post.id) }}" class="blog-post-btn">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                    <button class="blog-post-btn" onclick="deletePost({{ post.id }})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                    <span style="color: var(--smoke-gray);">
                        <i class="fas fa-heart"></i> {{ post.like_count }} â€¢
                        <i class="fas fa-comment"></i> {{ post.comment_count }}
                    </span>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div style="text-align: center; padding: 3rem; color: var(--smoke-gray);">
                <i class="fas fa-newspaper" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <h3>No published stories yet</h3>
                <p>Share your stories with the world!</p>
                <a href="{{ url_for('write_blog') }}" class="blog-btn" style="margin-top: 1rem;">
                    <i class="fas fa-pen-fancy"></i> Write Your First Story
                </a>
            </div>
        {% endif %}
    </div>

    <!-- Draft Posts -->
    <div id="drafts-section" class="blog-posts-container hidden">
        {% if draft_posts %}
            {% for post in draft_posts %}
            <div class="blog-post" style="border-left-color: var(--smoke-gray); opacity: 0.9;">
                <h3 class="blog-post-title">
                    {{ post.title }}
                    <span style="color: var(--smoke-gray); font-size: 0.8rem; font-weight: normal;">
                        <i class="fas fa-lock"></i> Draft
                    </span>
                </h3>
                <div class="blog-post-meta">
                    Last edited {{ post.updated_at|format_datetime }}
                    {% if post.ai_enhanced %}
                    <span style="color: var(--art-gold);"><i class="fas fa-robot"></i> AI Enhanced</span>
                    {% endif %}
                </div>
                <div class="blog-post-content">
                    {{ post.content|truncate_words(50) }}
                </div>
                <div class="blog-post-actions">
                    <a href="{{ url_for('edit_blog', post_id=post.id) }}" class="blog-post-btn">
                        <i class="fas fa-edit"></i> Continue Editing
                    </a>
                    <button class="blog-post-btn" onclick="publishDraft({{ post.id }})">
                        <i class="fas fa-paper-plane"></i> Publish Now
                    </button>
                    <button class="blog-post-btn" onclick="deletePost({{ post.id }})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div style="text-align: center; padding: 3rem; color: var(--smoke-gray);">
                <i class="fas fa-folder-open" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <h3>No drafts saved</h3>
                <p>Drafts are saved when you create posts without publishing them.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function showTab(tab) {
    const publishedSection = document.getElementById('published-section');
    const draftsSection = document.getElementById('drafts-section');
    const publishedBtn = document.getElementById('tab-published');
    const draftsBtn = document.getElementById('tab-drafts');

    if (tab === 'published') {
        publishedSection.classList.remove('hidden');
        draftsSection.classList.add('hidden');
        publishedBtn.classList.remove('secondary');
        draftsBtn.classList.add('secondary');
    } else {
        publishedSection.classList.add('hidden');
        draftsSection.classList.remove('hidden');
        publishedBtn.classList.add('secondary');
        draftsBtn.classList.remove('secondary');
    }
}

function deletePost(postId) {
    if (confirm('Are you sure you want to delete this post?')) {
        fetch(`/blog/delete/${postId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || 'Failed to delete post');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to delete post');
        });
    }
}

function publishDraft(postId) {
    if (confirm('Publish this draft now?')) {
        window.location.href = `/blog/edit/${postId}`;
    }
}
</script>
{% endblock %}
