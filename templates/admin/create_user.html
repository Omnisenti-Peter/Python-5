{% extends "base.html" %}

{% block title %}Create User - Admin{% endblock %}

{% set breadcrumbs = make_breadcrumbs(
    ('Home', url_for('index')),
    ('Admin', url_for('admin.dashboard')),
    ('Users', url_for('admin.manage_users')),
    ('Create User', None)
) %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold mb-2">
                <i class="fas fa-user-plus mr-3 text-green-600"></i>Create New User
            </h1>
            <p class="text-gray-600">Add a new user to the platform</p>
        </div>

        <!-- Form -->
        <div class="vintage-card p-8">
            <form method="POST" action="{{ url_for('admin.create_user') }}">
                <!-- Username -->
                <div class="mb-6">
                    <label for="username" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-user mr-1"></i>Username *
                    </label>
                    <input type="text" id="username" name="username" required
                           class="vintage-input w-full" placeholder="Enter username">
                </div>

                <!-- Email -->
                <div class="mb-6">
                    <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-envelope mr-1"></i>Email *
                    </label>
                    <input type="email" id="email" name="email" required
                           class="vintage-input w-full" placeholder="user@example.com">
                </div>

                <!-- Password -->
                <div class="mb-6">
                    <label for="password" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-lock mr-1"></i>Password *
                    </label>
                    <input type="password" id="password" name="password" required
                           class="vintage-input w-full" placeholder="Enter password" minlength="8">
                    <p class="text-xs text-gray-500 mt-1">Minimum 8 characters</p>
                </div>

                <!-- First Name -->
                <div class="mb-6">
                    <label for="first_name" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-id-card mr-1"></i>First Name
                    </label>
                    <input type="text" id="first_name" name="first_name"
                           class="vintage-input w-full" placeholder="Enter first name">
                </div>

                <!-- Last Name -->
                <div class="mb-6">
                    <label for="last_name" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-id-card mr-1"></i>Last Name
                    </label>
                    <input type="text" id="last_name" name="last_name"
                           class="vintage-input w-full" placeholder="Enter last name">
                </div>

                <!-- Role -->
                <div class="mb-6">
                    <label for="role_id" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-user-tag mr-1"></i>Role *
                    </label>
                    <select id="role_id" name="role_id" required class="vintage-input w-full">
                        <option value="">Select Role</option>
                        {% for role in roles %}
                        <option value="{{ role.id }}">{{ role.name }} - {{ role.description }}</option>
                        {% endfor %}
                    </select>
                    {% if session.user_role == 'Admin' %}
                    <p class="text-xs text-gray-500 mt-1">
                        <i class="fas fa-info-circle mr-1"></i>As an Admin, you can only create User and SuperUser roles
                    </p>
                    {% endif %}
                </div>

                <!-- Group (SuperAdmin only) -->
                {% if groups %}
                <div class="mb-6">
                    <label for="group_id" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-building mr-1"></i>Group/Organization
                    </label>
                    <select id="group_id" name="group_id" class="vintage-input w-full">
                        <option value="">No Group (Platform-wide)</option>
                        {% for group in groups %}
                        <option value="{{ group.id }}">{{ group.name }}</option>
                        {% endfor %}
                    </select>
                    <p class="text-xs text-gray-500 mt-1">
                        <i class="fas fa-info-circle mr-1"></i>Assign the user to a specific organization
                    </p>
                </div>
                {% else %}
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-info-circle text-blue-400"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-blue-700">
                                <strong>Note:</strong> This user will be created in your group automatically.
                            </p>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Buttons -->
                <div class="flex justify-between items-center mt-8">
                    <a href="{{ url_for('admin.manage_users') }}" class="text-gray-600 hover:text-gray-800">
                        <i class="fas fa-arrow-left mr-1"></i>Back to Users
                    </a>
                    <button type="submit" class="vintage-button">
                        <i class="fas fa-save mr-2"></i>Create User
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
