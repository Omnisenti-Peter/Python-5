{% extends "base.html" %}

{% block title %}Admin Dashboard - Opinian{% endblock %}

{% block content %}
<div class="section" style="padding-top: 100px; min-height: 100vh;">
    <div class="container">
        <div class="section-header">
            <h1 class="section-title">
                <i class="fas fa-chart-line"></i> Admin Dashboard
            </h1>
            <p class="section-subtitle">
                Monitor platform activity and manage content
            </p>
        </div>

        <!-- Key Metrics -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
            <div class="card" style="padding: 1.5rem; background: linear-gradient(135deg, var(--noir-burgundy) 0%, var(--noir-deep-burgundy) 100%);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                    <i class="fas fa-users" style="font-size: 2.5rem; color: var(--noir-gold); opacity: 0.8;"></i>
                    <span style="background: rgba(212, 175, 55, 0.2); color: var(--noir-gold); padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 600; border-radius: 12px;">
                        USERS
                    </span>
                </div>
                <h3 style="font-size: 2.5rem; color: var(--noir-cream); margin: 0; font-family: var(--font-serif);">
                    {{ stats.total_users }}
                </h3>
                <p style="color: var(--noir-light-gray); margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                    Total Registered Users
                </p>
            </div>

            <div class="card" style="padding: 1.5rem; background: linear-gradient(135deg, var(--noir-dark-gray) 0%, var(--noir-charcoal) 100%);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                    <i class="fas fa-book-open" style="font-size: 2.5rem; color: var(--noir-gold); opacity: 0.8;"></i>
                    <span style="background: rgba(212, 175, 55, 0.2); color: var(--noir-gold); padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 600; border-radius: 12px;">
                        PUBLISHED
                    </span>
                </div>
                <h3 style="font-size: 2.5rem; color: var(--noir-cream); margin: 0; font-family: var(--font-serif);">
                    {{ stats.total_blogs }}
                </h3>
                <p style="color: var(--noir-light-gray); margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                    Published Stories
                </p>
            </div>

            <div class="card" style="padding: 1.5rem; background: linear-gradient(135deg, var(--noir-charcoal) 0%, var(--noir-black) 100%);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                    <i class="fas fa-file-alt" style="font-size: 2.5rem; color: var(--noir-gold); opacity: 0.8;"></i>
                    <span style="background: rgba(212, 175, 55, 0.2); color: var(--noir-gold); padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 600; border-radius: 12px;">
                        DRAFTS
                    </span>
                </div>
                <h3 style="font-size: 2.5rem; color: var(--noir-cream); margin: 0; font-family: var(--font-serif);">
                    {{ stats.total_drafts }}
                </h3>
                <p style="color: var(--noir-light-gray); margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                    Unpublished Drafts
                </p>
            </div>

            <div class="card" style="padding: 1.5rem; background: linear-gradient(135deg, var(--noir-black) 0%, var(--noir-charcoal) 100%);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                    <i class="fas fa-robot" style="font-size: 2.5rem; color: var(--noir-gold); opacity: 0.8;"></i>
                    <span style="background: rgba(212, 175, 55, 0.2); color: var(--noir-gold); padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 600; border-radius: 12px;">
                        AI USES
                    </span>
                </div>
                <h3 style="font-size: 2.5rem; color: var(--noir-cream); margin: 0; font-family: var(--font-serif);">
                    {{ stats.ai_usage_count }}
                </h3>
                <p style="color: var(--noir-light-gray); margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                    AI Enhancements Used
                </p>
            </div>

            <div class="card" style="padding: 1.5rem; background: linear-gradient(135deg, var(--noir-deep-burgundy) 0%, var(--noir-burgundy) 100%);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                    <i class="fas fa-heart" style="font-size: 2.5rem; color: var(--noir-gold); opacity: 0.8;"></i>
                    <span style="background: rgba(212, 175, 55, 0.2); color: var(--noir-gold); padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 600; border-radius: 12px;">
                        LIKES
                    </span>
                </div>
                <h3 style="font-size: 2.5rem; color: var(--noir-cream); margin: 0; font-family: var(--font-serif);">
                    {{ stats.total_likes }}
                </h3>
                <p style="color: var(--noir-light-gray); margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                    Total Likes
                </p>
            </div>

            <div class="card" style="padding: 1.5rem; background: linear-gradient(135deg, var(--noir-charcoal) 0%, var(--noir-dark-gray) 100%);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                    <i class="fas fa-comment" style="font-size: 2.5rem; color: var(--noir-gold); opacity: 0.8;"></i>
                    <span style="background: rgba(212, 175, 55, 0.2); color: var(--noir-gold); padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 600; border-radius: 12px;">
                        COMMENTS
                    </span>
                </div>
                <h3 style="font-size: 2.5rem; color: var(--noir-cream); margin: 0; font-family: var(--font-serif);">
                    {{ stats.total_comments }}
                </h3>
                <p style="color: var(--noir-light-gray); margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                    Total Comments
                </p>
            </div>
        </div>

        <!-- Charts Row -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
            <!-- User Growth Chart -->
            <div class="card" style="padding: 2rem;">
                <h3 style="font-family: var(--font-serif); color: var(--noir-gold); margin-bottom: 1.5rem;">
                    <i class="fas fa-chart-line"></i> User Growth
                </h3>
                <div id="userGrowthChart" style="width: 100%; height: 300px;"></div>
            </div>

            <!-- Content Distribution Chart -->
            <div class="card" style="padding: 2rem;">
                <h3 style="font-family: var(--font-serif); color: var(--noir-gold); margin-bottom: 1.5rem;">
                    <i class="fas fa-chart-pie"></i> Content Distribution
                </h3>
                <div id="contentChart" style="width: 100%; height: 300px;"></div>
            </div>
        </div>

        <!-- Activity Chart -->
        <div class="card" style="padding: 2rem; margin-bottom: 2rem;">
            <h3 style="font-family: var(--font-serif); color: var(--noir-gold); margin-bottom: 1.5rem;">
                <i class="fas fa-chart-area"></i> Platform Activity (Last 7 Days)
            </h3>
            <div id="activityChart" style="width: 100%; height: 350px;"></div>
        </div>

        <!-- Recent Activity Tables -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <!-- Recent Posts -->
            <div class="card" style="padding: 2rem;">
                <h3 style="font-family: var(--font-serif); color: var(--noir-gold); margin-bottom: 1.5rem;">
                    <i class="fas fa-clock"></i> Recent Stories
                </h3>
                {% if stats.recent_posts %}
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    {% for post in stats.recent_posts %}
                    <div style="padding: 1rem; background: rgba(45, 45, 45, 0.3); border-left: 3px solid var(--noir-gold);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <h4 style="color: var(--noir-cream); font-size: 0.95rem; margin: 0;">
                                {{ post.title|truncate(40) }}
                            </h4>
                            {% if post.ai_enhanced %}
                            <span style="background: var(--noir-burgundy); color: var(--noir-gold); padding: 0.15rem 0.5rem; font-size: 0.65rem; font-weight: 600;">
                                AI
                            </span>
                            {% endif %}
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--noir-light-gray);">
                            <span><i class="fas fa-user"></i> {{ post.author.username }}</span>
                            <span><i class="far fa-calendar"></i> {{ post.created_at.strftime('%b %d') }}</span>
                            <span><i class="fas fa-heart"></i> {{ post.like_count }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: var(--noir-gray); text-align: center; padding: 2rem;">No recent posts</p>
                {% endif %}
            </div>

            <!-- Recent Users -->
            <div class="card" style="padding: 2rem;">
                <h3 style="font-family: var(--font-serif); color: var(--noir-gold); margin-bottom: 1.5rem;">
                    <i class="fas fa-user-plus"></i> Recent Users
                </h3>
                {% if stats.recent_users %}
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    {% for user in stats.recent_users %}
                    <div style="padding: 1rem; background: rgba(45, 45, 45, 0.3); border-left: 3px solid var(--noir-gold);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="color: var(--noir-cream); font-size: 0.95rem; margin: 0 0 0.25rem 0;">
                                    <i class="fas fa-user-circle"></i> {{ user.username }}
                                </h4>
                                <p style="color: var(--noir-light-gray); font-size: 0.8rem; margin: 0;">
                                    {{ user.email }}
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <span style="display: block; font-size: 0.8rem; color: var(--noir-light-gray);">
                                    {{ user.created_at.strftime('%b %d, %Y') }}
                                </span>
                                {% if user.is_admin %}
                                <span style="background: var(--noir-gold); color: var(--noir-black); padding: 0.15rem 0.5rem; font-size: 0.65rem; font-weight: 600; margin-top: 0.25rem; display: inline-block;">
                                    ADMIN
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: var(--noir-gray); text-align: center; padding: 2rem;">No recent users</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // User Growth Chart
        const userGrowthChart = echarts.init(document.getElementById('userGrowthChart'));
        userGrowthChart.setOption({
            backgroundColor: 'transparent',
            tooltip: {
                trigger: 'axis',
                backgroundColor: 'rgba(10, 10, 10, 0.9)',
                borderColor: '#d4af37',
                textStyle: { color: '#f5f5dc' }
            },
            grid: {
                left: '10%',
                right: '10%',
                bottom: '15%',
                top: '10%'
            },
            xAxis: {
                type: 'category',
                data: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                axisLine: { lineStyle: { color: '#4a4a4a' } },
                axisLabel: { color: '#a0a0a0' }
            },
            yAxis: {
                type: 'value',
                axisLine: { lineStyle: { color: '#4a4a4a' } },
                axisLabel: { color: '#a0a0a0' },
                splitLine: { lineStyle: { color: '#2a2a2a' } }
            },
            series: [{
                data: [5, 12, 18, 28, 35, {{ stats.total_users }}],
                type: 'line',
                smooth: true,
                lineStyle: { color: '#d4af37', width: 3 },
                itemStyle: { color: '#d4af37' },
                areaStyle: {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                        offset: 0,
                        color: 'rgba(212, 175, 55, 0.3)'
                    }, {
                        offset: 1,
                        color: 'rgba(212, 175, 55, 0.05)'
                    }])
                }
            }]
        });

        // Content Distribution Chart
        const contentChart = echarts.init(document.getElementById('contentChart'));
        contentChart.setOption({
            backgroundColor: 'transparent',
            tooltip: {
                trigger: 'item',
                backgroundColor: 'rgba(10, 10, 10, 0.9)',
                borderColor: '#d4af37',
                textStyle: { color: '#f5f5dc' }
            },
            legend: {
                bottom: '5%',
                left: 'center',
                textStyle: { color: '#a0a0a0' }
            },
            series: [{
                type: 'pie',
                radius: ['40%', '70%'],
                avoidLabelOverlap: false,
                itemStyle: {
                    borderRadius: 10,
                    borderColor: '#0a0a0a',
                    borderWidth: 2
                },
                label: {
                    show: false
                },
                emphasis: {
                    label: {
                        show: true,
                        fontSize: 16,
                        fontWeight: 'bold',
                        color: '#f5f5dc'
                    }
                },
                data: [
                    { value: {{ stats.total_blogs }}, name: 'Published', itemStyle: { color: '#722f37' } },
                    { value: {{ stats.total_drafts }}, name: 'Drafts', itemStyle: { color: '#4a4a4a' } },
                    { value: {{ stats.ai_usage_count }}, name: 'AI Enhanced', itemStyle: { color: '#d4af37' } }
                ]
            }]
        });

        // Activity Chart
        const activityChart = echarts.init(document.getElementById('activityChart'));
        activityChart.setOption({
            backgroundColor: 'transparent',
            tooltip: {
                trigger: 'axis',
                backgroundColor: 'rgba(10, 10, 10, 0.9)',
                borderColor: '#d4af37',
                textStyle: { color: '#f5f5dc' }
            },
            legend: {
                data: ['Posts', 'Comments', 'Likes'],
                top: '0%',
                textStyle: { color: '#a0a0a0' }
            },
            grid: {
                left: '10%',
                right: '10%',
                bottom: '10%',
                top: '15%'
            },
            xAxis: {
                type: 'category',
                data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                axisLine: { lineStyle: { color: '#4a4a4a' } },
                axisLabel: { color: '#a0a0a0' }
            },
            yAxis: {
                type: 'value',
                axisLine: { lineStyle: { color: '#4a4a4a' } },
                axisLabel: { color: '#a0a0a0' },
                splitLine: { lineStyle: { color: '#2a2a2a' } }
            },
            series: [
                {
                    name: 'Posts',
                    type: 'bar',
                    data: [5, 8, 12, 7, 10, 15, 9],
                    itemStyle: { color: '#722f37' }
                },
                {
                    name: 'Comments',
                    type: 'bar',
                    data: [12, 15, 20, 18, 22, 28, 25],
                    itemStyle: { color: '#4a4a4a' }
                },
                {
                    name: 'Likes',
                    type: 'line',
                    data: [20, 25, 35, 30, 40, 50, 45],
                    lineStyle: { color: '#d4af37', width: 3 },
                    itemStyle: { color: '#d4af37' }
                }
            ]
        });

        // Resize charts on window resize
        window.addEventListener('resize', function() {
            userGrowthChart.resize();
            contentChart.resize();
            activityChart.resize();
        });

        // Animate metrics on load
        anime({
            targets: '.card',
            opacity: [0, 1],
            translateY: [30, 0],
            duration: 600,
            easing: 'easeOutExpo',
            delay: anime.stagger(50)
        });
    });
</script>
{% endblock %}
