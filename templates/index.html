{% extends "base.html" %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="hero-container">
        <div class="hero-content">
            <h1 class="hero-title">
                <span id="typed-text"></span>
            </h1>
            <p class="hero-subtitle">
                Step into a world where the elegance of 1920s storytelling meets the power of modern AI.
                Create compelling narratives that captivate, inspire, and endure through the ages.
            </p>
            <div class="hero-actions">
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('blog.editor') }}" class="btn btn-primary">Start Writing</a>
                    <a href="{{ url_for('ai.ai_tools') }}" class="btn btn-secondary">AI Assistant</a>
                {% else %}
                    <a href="{{ url_for('auth.register') }}" class="btn btn-primary">Start Writing</a>
                    <a href="{{ url_for('ai.ai_tools') }}" class="btn btn-secondary">AI Assistant</a>
                {% endif %}
            </div>
        </div>
        <div class="hero-visual">
            <div class="hero-image"></div>
        </div>
    </div>
</section>

<!-- Search & Filter Section -->
<section class="section" style="background: var(--noir-charcoal); padding: 3rem 0;">
    <div class="container">
        <form method="GET" action="{{ url_for('main.index') }}" style="display: flex; gap: 1rem; max-width: 800px; margin: 0 auto;">
            <input type="text"
                   name="search"
                   class="form-control"
                   placeholder="Search stories by title or content..."
                   value="{{ search_query or '' }}"
                   style="flex: 1;">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i> Search
            </button>
        </form>
    </div>
</section>

<!-- Featured Blogs Section -->
<section id="featured" class="section" style="background: var(--noir-black);">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-star"></i> Featured Stories
            </h2>
            <p class="section-subtitle">
                Discover the most captivating tales from our community of writers
            </p>
        </div>

        {% if posts.items %}
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 2rem;">
                {% for post in posts.items %}
                <div class="card" style="cursor: pointer; display: flex; flex-direction: column; height: 100%; min-height: 380px;" onclick="window.location.href='{{ url_for('main.view_post', slug=post.slug) }}'">
                    <!-- Card Header (Title + Badge) -->
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; min-height: 3.6em;">
                        <h3 class="card-title" style="flex: 1; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; line-height: 1.4; height: 2.8em;">{{ post.title }}</h3>
                        {% if post.ai_assisted %}
                        <span style="background: var(--noir-burgundy); color: var(--noir-gold); padding: 0.25rem 0.75rem; font-size: 0.7rem; font-weight: 600; letter-spacing: 0.05em; white-space: nowrap; margin-left: 0.5rem; height: fit-content;">
                            <i class="fas fa-robot"></i> AI
                        </span>
                        {% endif %}
                    </div>

                    <!-- Card Content (Fixed Height) -->
                    <div class="card-content" style="color: var(--noir-light-gray); margin-bottom: 1rem; flex: 1; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; line-height: 1.6; max-height: 6.4em;">
                        {{ post.content[:200] }}{% if post.content|length > 200 %}...{% endif %}
                    </div>

                    <!-- Card Footer (Meta Info) -->
                    <div style="margin-top: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid var(--noir-gray); margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; font-size: 0.85rem; color: var(--noir-light-gray);">
                                <span><i class="fas fa-user"></i> {{ post.author.username }}</span>
                                <span><i class="far fa-calendar"></i> {{ post.created_at.strftime('%b %d') }}</span>
                            </div>
                            <div style="display: flex; gap: 1rem; font-size: 0.85rem; color: var(--noir-gold);">
                                <span title="{{ post.like_count }} likes"><i class="fas fa-heart"></i> {{ post.like_count }}</span>
                                <span title="{{ post.comment_count }} comments"><i class="fas fa-comment"></i> {{ post.comment_count }}</span>
                            </div>
                        </div>

                        <!-- Action Buttons (Always Present for Consistent Height) -->
                        {% if current_user.is_authenticated and current_user.id == post.user_id %}
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="{{ url_for('blog.edit_blog', post_id=post.id) }}" class="btn btn-outline" style="font-size: 0.8rem; padding: 0.4rem 0.8rem; flex: 1;" onclick="event.stopPropagation();">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                            <button onclick="event.stopPropagation(); deletePost({{ post.id }})" class="btn btn-secondary" style="font-size: 0.8rem; padding: 0.4rem 0.8rem; flex: 1;">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                        {% else %}
                        <div style="height: 36px;"></div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if posts.pages > 1 %}
            <div style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 3rem;">
                {% if posts.has_prev %}
                <a href="{{ url_for('main.index', page=posts.prev_num, search=search_query or '') }}" class="btn btn-secondary">
                    <i class="fas fa-chevron-left"></i> Previous
                </a>
                {% endif %}

                {% for page_num in posts.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                    {% if page_num %}
                        {% if page_num == posts.page %}
                        <span class="btn btn-primary" style="pointer-events: none;">{{ page_num }}</span>
                        {% else %}
                        <a href="{{ url_for('main.index', page=page_num, search=search_query or '') }}" class="btn btn-outline">{{ page_num }}</a>
                        {% endif %}
                    {% else %}
                    <span style="color: var(--noir-light-gray); padding: 0.75rem;">...</span>
                    {% endif %}
                {% endfor %}

                {% if posts.has_next %}
                <a href="{{ url_for('main.index', page=posts.next_num, search=search_query or '') }}" class="btn btn-secondary">
                    Next <i class="fas fa-chevron-right"></i>
                </a>
                {% endif %}
            </div>
            {% endif %}

        {% else %}
            <div style="text-align: center; padding: 4rem 2rem;">
                <i class="fas fa-book-open" style="font-size: 4rem; color: var(--noir-gray); margin-bottom: 1rem; opacity: 0.5;"></i>
                <h3 style="color: var(--noir-light-gray); margin-bottom: 1rem;">No stories found</h3>
                {% if search_query %}
                <p style="color: var(--noir-gray); margin-bottom: 2rem;">Try adjusting your search criteria</p>
                <a href="{{ url_for('main.index') }}" class="btn btn-primary">
                    <i class="fas fa-redo"></i> Clear Search
                </a>
                {% else %}
                <p style="color: var(--noir-gray); margin-bottom: 2rem;">Be the first to share your story with the world!</p>
                {% endif %}
            </div>
        {% endif %}
    </div>
</section>

<!-- AI Assistant Section -->
<section class="ai-assistant" style="padding: 120px 0; background: var(--noir-charcoal);">
    <div class="ai-container" style="max-width: var(--container-max); margin: 0 auto; padding: 0 2rem; display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; align-items: center;">
        <div class="ai-content">
            <div class="section-header" style="text-align: left;">
                <h2 class="section-title" style="font-family: var(--font-serif); font-size: 3rem; color: var(--noir-gold); margin-bottom: 1rem;">
                    AI Writing Assistant
                </h2>
                <p class="section-subtitle" style="font-size: 1.2rem; color: var(--noir-light-gray); line-height: 1.8; margin-bottom: 2rem;">
                    Enhance your storytelling with intelligent suggestions, idea generation,
                    and content optimization powered by advanced AI.
                </p>
            </div>
            <div class="hero-actions" style="gap: 1rem;">
                <a href="{{ url_for('ai.ai_tools') }}" class="btn btn-primary">Try AI Assistant</a>
                <a href="{{ url_for('main.about') }}#ai" class="btn btn-secondary">Learn More</a>
            </div>
        </div>
        <div class="ai-visual">
            <div class="ai-interface" style="background: var(--noir-black); border: 1px solid var(--noir-gold); padding: 2rem; border-radius: 0; font-family: 'Courier New', monospace;">
                <div class="ai-prompt" style="color: var(--noir-gold); margin-bottom: 1rem; font-size: 0.95rem;">
                    > Generate blog ideas about "noir storytelling"
                </div>
                <div class="ai-response" style="color: var(--noir-cream); margin-bottom: 2rem; padding-left: 1rem; border-left: 2px solid var(--noir-burgundy); line-height: 1.8;">
                    <strong style="color: var(--noir-gold);">Shadows and Pixels: Modern Storytelling</strong><br>
                    Explore how noir aesthetics influence contemporary digital narratives...
                </div>
                <div class="ai-prompt" style="color: var(--noir-gold); margin-bottom: 1rem; font-size: 0.95rem;">
                    > Enhance this paragraph for better engagement
                </div>
                <div class="ai-response" style="color: var(--noir-cream); padding-left: 1rem; border-left: 2px solid var(--noir-burgundy); line-height: 1.8;">
                    In the shadowy realm where digital meets dramatic,
                    every pixel tells a story waiting to unfold...
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Statistics Section - Hidden for now, can be enabled later with real data -->
<!--
<section class="stats" style="padding: 80px 0; background: var(--noir-black);">
    <div class="stats-container" style="max-width: var(--container-max); margin: 0 auto; padding: 0 2rem;">
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 3rem; text-align: center;">
            <div class="stat-item">
                <span class="stat-number" data-count="2847" style="display: block; font-family: var(--font-serif); font-size: 3.5rem; font-weight: 700; color: var(--noir-gold); margin-bottom: 0.5rem;">0</span>
                <span class="stat-label" style="font-size: 1.1rem; color: var(--noir-light-gray); letter-spacing: 0.05em;">Stories Told</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" data-count="1562" style="display: block; font-family: var(--font-serif); font-size: 3.5rem; font-weight: 700; color: var(--noir-gold); margin-bottom: 0.5rem;">0</span>
                <span class="stat-label" style="font-size: 1.1rem; color: var(--noir-light-gray); letter-spacing: 0.05em;">Active Writers</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" data-count="89" style="display: block; font-family: var(--font-serif); font-size: 3.5rem; font-weight: 700; color: var(--noir-gold); margin-bottom: 0.5rem;">0</span>
                <span class="stat-label" style="font-size: 1.1rem; color: var(--noir-light-gray); letter-spacing: 0.05em;">Awards Won</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" data-count="45678" style="display: block; font-family: var(--font-serif); font-size: 3.5rem; font-weight: 700; color: var(--noir-gold); margin-bottom: 0.5rem;">0</span>
                <span class="stat-label" style="font-size: 1.1rem; color: var(--noir-light-gray); letter-spacing: 0.05em;">Total Readers</span>
            </div>
        </div>
    </div>
</section>
-->
{% endblock %}

{% block extra_js %}
<script>
    // Typed.js hero text animation
    document.addEventListener('DOMContentLoaded', function() {
        new Typed('#typed-text', {
            strings: [
                'Where Stories<br>Come Alive',
                'Where Noir Meets<br>Digital Age',
                'Where AI Enhances<br>Creativity',
                'Where Every Voice<br>Finds Power'
            ],
            typeSpeed: 60,
            backSpeed: 30,
            backDelay: 2000,
            loop: true,
            showCursor: true,
            cursorChar: '|'
        });

        // Animate hero elements
        anime({
            targets: '.hero-content',
            opacity: [0, 1],
            translateY: [50, 0],
            duration: 1000,
            easing: 'easeOutExpo',
            delay: 300
        });

        anime({
            targets: '.hero-visual',
            opacity: [0, 1],
            translateX: [50, 0],
            duration: 1000,
            easing: 'easeOutExpo',
            delay: 500
        });

        // Intersection Observer for statistics animation
        const observerOptions = {
            threshold: 0.3,
            rootMargin: '0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !entry.target.classList.contains('animated')) {
                    entry.target.classList.add('animated');
                    animateCounters();
                }
            });
        }, observerOptions);

        const statsSection = document.querySelector('.stats');
        if (statsSection) {
            observer.observe(statsSection);
        }

        // Animate statistics counters
        function animateCounters() {
            document.querySelectorAll('.stat-number').forEach(counter => {
                const target = parseInt(counter.dataset.count);
                const duration = 2000;
                const increment = target / (duration / 16);
                let current = 0;

                const updateCounter = () => {
                    current += increment;
                    if (current < target) {
                        counter.textContent = Math.floor(current).toLocaleString();
                        requestAnimationFrame(updateCounter);
                    } else {
                        counter.textContent = target.toLocaleString();
                    }
                };

                updateCounter();
            });
        }
    });

    // Delete post function
    function deletePost(postId) {
        if (confirm('Are you sure you want to delete this story? This action cannot be undone.')) {
            fetch(`/blog/delete/${postId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert(data.message || 'Failed to delete post');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to delete post');
            });
        }
    }
</script>
{% endblock %}
