{% extends "base.html" %}

{% block title %}AI Story Enhancer - Opinian{% endblock %}

{% block content %}
<div class="ai-container art-deco-border noir-shadow">
    <div class="ai-header">
        <h2 class="ai-title">
            <i class="fas fa-robot"></i> AI Story Enhancer
        </h2>
        <p class="ai-subtitle">Transform your ideas into captivating narratives</p>
    </div>

    <form method="POST" action="{{ url_for('enhance_with_ai') }}" id="ai-form">
        <div class="ai-input-section">
            <label class="form-label" for="ai-input">Your Story Ideas or Rough Draft</label>
            <textarea id="ai-input"
                      name="text"
                      class="ai-input"
                      placeholder="Share your story ideas, rough drafts, or key points here. Our AI will help you craft them into compelling narratives.

Example:
• A detective story set in 1940s Chicago
• A romance between a flapper and a jazz musician
• A mystery involving a speakeasy and forbidden love

The more details you provide, the better the AI can assist you!">{% if input_text %}{{ input_text }}{% endif %}</textarea>
        </div>

        <button type="submit" id="ai-rewrite-btn" class="ai-rewrite-btn">
            <i class="fas fa-magic"></i> Enhance My Story
        </button>

        <div class="ai-output-section">
            <label class="form-label" for="ai-output">AI-Enhanced Story</label>
            <textarea id="ai-output"
                      class="ai-output"
                      readonly
                      placeholder="Your enhanced story will appear here...

The AI will:
• Improve your writing style
• Add descriptive language
• Structure your narrative
• Enhance engagement
• Maintain your unique voice">{% if enhanced_text %}{{ enhanced_text }}{% endif %}</textarea>

            <div class="ai-actions">
                <button type="button" class="ai-btn" onclick="exportToBlog()" id="export-blog-btn" {% if not enhanced_text %}disabled{% endif %}>
                    <i class="fas fa-file-export"></i> Export to Blog
                </button>
                <button type="button" class="ai-btn secondary" onclick="copyToClipboard()" {% if not enhanced_text %}disabled{% endif %}>
                    <i class="fas fa-copy"></i> Copy to Clipboard
                </button>
                <button type="button" class="ai-btn secondary" onclick="clearAI()">
                    <i class="fas fa-trash"></i> Clear
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Handle form submission with loading state
document.getElementById('ai-form').addEventListener('submit', function(e) {
    const button = document.getElementById('ai-rewrite-btn');
    button.disabled = true;
    button.innerHTML = '<span class="spinner"></span> Enhancing your story...';
});

function exportToBlog() {
    const enhancedText = document.getElementById('ai-output').value;
    if (!enhancedText) {
        alert('No content to export. Please generate AI-enhanced text first.');
        return;
    }

    // Ask user for a title
    const title = prompt('Enter a title for your blog post:', 'My AI-Enhanced Story');

    if (!title) {
        return; // User cancelled
    }

    // Ask if they want to publish now or save as draft
    const publishNow = confirm('Do you want to PUBLISH this story now?\n\nClick OK to publish immediately.\nClick Cancel to save as a draft and edit later.');

    // Create a form to send the data
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '{{ url_for("create_blog") }}';

    const titleInput = document.createElement('input');
    titleInput.type = 'hidden';
    titleInput.name = 'title';
    titleInput.value = title;

    const contentInput = document.createElement('input');
    contentInput.type = 'hidden';
    contentInput.name = 'content';
    contentInput.value = enhancedText;

    const publishInput = document.createElement('input');
    publishInput.type = 'hidden';
    publishInput.name = 'publish';
    publishInput.value = publishNow ? 'true' : 'false';

    const aiEnhancedInput = document.createElement('input');
    aiEnhancedInput.type = 'hidden';
    aiEnhancedInput.name = 'ai_enhanced';
    aiEnhancedInput.value = 'true';

    form.appendChild(titleInput);
    form.appendChild(contentInput);
    form.appendChild(publishInput);
    form.appendChild(aiEnhancedInput);

    document.body.appendChild(form);
    form.submit();
}

function copyToClipboard() {
    const output = document.getElementById('ai-output');
    output.select();
    output.setSelectionRange(0, 99999); // For mobile devices

    navigator.clipboard.writeText(output.value).then(() => {
        alert('Content copied to clipboard!');
    }).catch(() => {
        alert('Failed to copy to clipboard. Please copy manually.');
    });
}

function clearAI() {
    if (confirm('Clear all content?')) {
        document.getElementById('ai-input').value = '';
        document.getElementById('ai-output').value = '';
    }
}
</script>
{% endblock %}
